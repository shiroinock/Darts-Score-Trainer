# 次のタスクを選定して実装

TODO.mdから次に着手すべきタスクを選定し、ブランチを作成して実装してください。

## 手順

### 1. タスク選定とブランチ作成

1. **TODO.mdを読み込み**、未完了のタスク（`- [ ]`）を特定する
2. **依存関係を確認**：
   - 先行タスクが完了しているか確認
   - 同一サブセクション内のタスクは上から順に実行
   - 例：1.1の型定義が完了していないと1.2以降に着手しない
3. **最小単位のタスクを選定**：
   - サブセクション単位（例：1.1 型定義、1.2 定数定義）を1タスクとする
   - サブセクションが大きい場合は、さらに分割を検討
4. **COMPLETE_SPECIFICATION.md**から該当タスクの詳細仕様を抽出
5. **ブランチ名を生成**：
   - 形式: `feature/<phase>-<section>-<short-description>`
   - 例: `feature/1-1-type-definitions`
6. **ユーザーに確認**を求める：
   ```
   ## 次のタスク

   **Phase**: X
   **セクション**: X.Y タスク名
   **ブランチ名**: `feature/x-y-description`

   ### タスク内容
   - [ ] タスク1
   - [ ] タスク2

   ### 関連仕様
   COMPLETE_SPECIFICATION.mdからの抜粋...

   ### 依存関係
   - 先行タスク: （あれば）

   このタスクを実装してよろしいですか？
   ```
7. **承認されたらブランチを作成**：
   ```bash
   git checkout -b <branch-name>
   ```

### 2. 実装

8. **implementサブエージェント**（subagent_type: implement）をTaskツールで起動し、以下を含むプロンプトを渡す：
   - 実装すべきタスクの明確な説明
   - COMPLETE_SPECIFICATION.mdからの関連仕様
   - 期待される成果物（ファイルパス、関数名など）
   - 依存関係（既存のファイルやモジュールがあれば）
9. サブエージェント完了後、**SubagentStop hookが自動実行**され、evaluate-subagent.shがimplement.mdを評価・改善する

### 3. 完了処理

10. **TODO.mdを更新**：完了したタスクに`[x]`をマークし、進捗表を更新する
11. **結果を報告**：実装されたファイル、hookによる改善内容（あれば）をユーザーに報告

## ブランチ命名規則

- `feature/` プレフィックス
- Phase番号とセクション番号をハイフン区切りで含める
- 短い英語の説明（ケバブケース）
- 例：
  - `feature/1-1-type-definitions`
  - `feature/1-3-coordinate-transform`
  - `feature/2-2-p5-canvas`
  - `feature/5-1-preset-selector`

## 注意事項

- mainブランチから新しいブランチを切る
- 既に同名のブランチが存在しないか確認
- 依存関係のあるタスクは、先行タスクが完了していることを確認してから実行
- エラーが発生した場合は、原因を特定してユーザーに報告
- タスク選定とブランチ作成、実装を一貫して行うことで、タスクの範囲が一致することを保証
